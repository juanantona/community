Version =20
VersionRequired =20
Begin Form
    PopUp = NotDefault
    DividingLines = NotDefault
    AllowDesignChanges = NotDefault
    DefaultView =0
    PictureAlignment =2
    DatasheetGridlinesBehavior =3
    GridY =10
    Width =9127
    DatasheetFontHeight =11
    ItemSuffix =53
    Left =5265
    Top =3030
    Right =14925
    Bottom =10320
    DatasheetGridlinesColor =14806254
    RecSrcDt = Begin
        0x60d7bae5dddfe440
    End
    DatasheetFontName ="Calibri"
    PrtMip = Begin
        0x6801000068010000680100006801000000000000201c0000e010000001000000 ,
        0x010000006801000000000000a10700000100000001000000
    End
    AllowDatasheetView =0
    AllowPivotTableView =0
    AllowPivotChartView =0
    AllowPivotChartView =0
    FilterOnLoad =0
    ShowPageMargins =0
    DisplayOnSharePointSite =1
    DatasheetAlternateBackColor =15921906
    DatasheetGridlinesColor12 =0
    FitToScreen =1
    DatasheetBackThemeColorIndex =1
    BorderThemeColorIndex =3
    ThemeFontIndex =1
    ForeThemeColorIndex =0
    AlternateBackThemeColorIndex =1
    AlternateBackShade =95.0
    Begin
        Begin Label
            BackStyle =0
            FontSize =11
            FontName ="Calibri"
            ThemeFontIndex =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =0
            BorderTint =50.0
            ForeThemeColorIndex =0
            ForeTint =50.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin CommandButton
            Width =1701
            Height =283
            FontSize =11
            FontWeight =400
            FontName ="Calibri"
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
            UseTheme =1
            Shape =1
            Gradient =12
            BackThemeColorIndex =4
            BackTint =60.0
            BorderLineStyle =0
            BorderColor =16777215
            BorderThemeColorIndex =4
            BorderTint =60.0
            ThemeFontIndex =1
            HoverThemeColorIndex =4
            HoverTint =40.0
            PressedThemeColorIndex =4
            PressedShade =75.0
            HoverForeThemeColorIndex =0
            HoverForeTint =75.0
            PressedForeThemeColorIndex =0
            PressedForeTint =75.0
        End
        Begin TextBox
            AddColon = NotDefault
            FELineBreak = NotDefault
            BorderLineStyle =0
            Width =1701
            LabelX =-1701
            FontSize =11
            FontName ="Calibri"
            AsianLineBreak =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            ThemeFontIndex =1
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin ListBox
            AddColon = NotDefault
            BorderLineStyle =0
            Height =454
            LabelX =-1701
            FontSize =11
            FontName ="Calibri"
            AllowValueListEdits =1
            InheritValueList =1
            ThemeFontIndex =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin ComboBox
            AddColon = NotDefault
            BorderLineStyle =0
            Width =1701
            LabelX =-1701
            FontSize =11
            FontName ="Calibri"
            AllowValueListEdits =1
            InheritValueList =1
            ThemeFontIndex =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            ForeThemeColorIndex =2
            ForeShade =50.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin Subform
            BorderLineStyle =0
            Width =1701
            Height =1701
            BorderThemeColorIndex =1
            GridlineThemeColorIndex =1
            GridlineShade =65.0
            BorderShade =65.0
            ShowPageHeaderAndPageFooter =1
        End
        Begin EmptyCell
            Height =240
            GridlineColor =12632256
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin NavigationControl
            BorderWidth =1
            BorderLineStyle =0
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin FormHeader
            Height =963
            BackColor =15849926
            Name ="EncabezadoDelFormulario"
            AutoHeight =1
            AlternateBackThemeColorIndex =1
            AlternateBackShade =95.0
            BackThemeColorIndex =2
            BackTint =20.0
            Begin
                Begin Label
                    OverlapFlags =85
                    Left =737
                    Top =113
                    Width =6066
                    Height =850
                    FontSize =16
                    BorderColor =8355711
                    ForeColor =8355711
                    Name ="Etiqueta5"
                    Caption ="COMUNIDAD 11"
                    GridlineColor =10921638
                    LayoutCachedLeft =737
                    LayoutCachedTop =113
                    LayoutCachedWidth =6803
                    LayoutCachedHeight =963
                End
            End
        End
        Begin Section
            Height =6349
            Name ="Detalle"
            AlternateBackColor =15921906
            AlternateBackThemeColorIndex =1
            AlternateBackShade =95.0
            BackThemeColorIndex =1
            Begin
                Begin Subform
                    OverlapFlags =85
                    Left =1770
                    Top =360
                    Width =6735
                    Height =1695
                    BorderColor =10921638
                    Name ="Secundario0"
                    SourceObject ="Form.sfrmMembersDataView"
                    GroupTable =1
                    BottomPadding =150
                    GridlineColor =10921638

                    LayoutCachedLeft =1770
                    LayoutCachedTop =360
                    LayoutCachedWidth =8505
                    LayoutCachedHeight =2055
                    ColumnStart =1
                    ColumnEnd =1
                    LayoutGroup =1
                    GroupTable =1
                    Begin
                        Begin Label
                            OverlapFlags =85
                            TextAlign =1
                            Left =360
                            Top =360
                            Width =1350
                            Height =1695
                            BorderColor =8355711
                            ForeColor =8355711
                            Name ="Etiqueta1"
                            Caption ="Hermanos:"
                            GroupTable =1
                            BottomPadding =150
                            GridlineColor =10921638
                            LayoutCachedLeft =360
                            LayoutCachedTop =360
                            LayoutCachedWidth =1710
                            LayoutCachedHeight =2055
                            LayoutGroup =1
                            GroupTable =1
                        End
                    End
                End
                Begin CommandButton
                    OverlapFlags =85
                    Left =5555
                    Top =2494
                    Width =2944
                    Height =348
                    TabIndex =1
                    ForeColor =4210752
                    Name ="cmdGenerateRandomGroups"
                    Caption ="Generar grupos"
                    OnClick ="[Event Procedure]"
                    GridlineColor =10921638

                    LayoutCachedLeft =5555
                    LayoutCachedTop =2494
                    LayoutCachedWidth =8499
                    LayoutCachedHeight =2842
                    BackColor =14136213
                    BorderColor =14136213
                    HoverColor =15060409
                    PressedColor =9592887
                    HoverForeColor =4210752
                    PressedForeColor =4210752
                    WebImagePaddingLeft =2
                    WebImagePaddingTop =2
                    WebImagePaddingRight =1
                    WebImagePaddingBottom =1
                    Overlaps =1
                End
                Begin TextBox
                    OverlapFlags =85
                    IMESentenceMode =3
                    Left =1713
                    Top =3401
                    Width =6796
                    Height =2550
                    TabIndex =2
                    BorderColor =10921638
                    ForeColor =4210752
                    Name ="txtGroups"
                    GridlineColor =10921638

                    LayoutCachedLeft =1713
                    LayoutCachedTop =3401
                    LayoutCachedWidth =8509
                    LayoutCachedHeight =5951
                    Begin
                        Begin Label
                            OverlapFlags =85
                            Left =453
                            Top =3401
                            Width =705
                            Height =315
                            BorderColor =8355711
                            ForeColor =8355711
                            Name ="Etiqueta8"
                            Caption ="Grupos"
                            GridlineColor =10921638
                            LayoutCachedLeft =453
                            LayoutCachedTop =3401
                            LayoutCachedWidth =1158
                            LayoutCachedHeight =3716
                        End
                    End
                End
                Begin ComboBox
                    OverlapFlags =85
                    IMESentenceMode =3
                    ColumnCount =2
                    ListWidth =1440
                    Left =4204
                    Top =2494
                    Width =671
                    Height =315
                    TabIndex =3
                    BoundColumn =1
                    BorderColor =10921638
                    ForeColor =4138256
                    ColumnInfo ="\"\";\"\";\"\";\"\";\"4\";\"4\""
                    Name ="ctrNumberOfMembersEachGroup"
                    RowSourceType ="Table/Query"
                    RowSource ="SELECT lstNumbers.Id, lstNumbers.Number FROM lstNumbers ORDER BY lstNumbers.[Id]"
                        "; "
                    ColumnWidths ="0;1442"
                    GridlineColor =10921638

                    LayoutCachedLeft =4204
                    LayoutCachedTop =2494
                    LayoutCachedWidth =4875
                    LayoutCachedHeight =2809
                    Begin
                        Begin Label
                            OverlapFlags =85
                            Left =396
                            Top =2494
                            Width =3405
                            Height =320
                            BorderColor =8355711
                            ForeColor =8355711
                            Name ="Número de personas en cada grupo_Etiqueta"
                            Caption ="Número de personas en cada grupo"
                            EventProcPrefix ="Número_de_personas_en_cada_grupo_Etiqueta"
                            GridlineColor =10921638
                            LayoutCachedLeft =396
                            LayoutCachedTop =2494
                            LayoutCachedWidth =3801
                            LayoutCachedHeight =2814
                        End
                    End
                End
            End
        End
        Begin FormFooter
            Height =0
            Name ="PieDelFormulario"
            AutoHeight =1
            AlternateBackThemeColorIndex =1
            AlternateBackShade =95.0
            BackThemeColorIndex =1
        End
    End
End
CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Compare Database

Private Sub cmdGenerateRandomGroups_Click()
  
  Dim groups() As String
  Dim group As String
  Dim numberOfGroups, numberOfMembersEachGroup As Integer
  Dim groupIndex, brotherIndex, randomIndex, memberIndex As Integer
  
  Dim rsoMembers As ADODB.recordset
  Set rsoMembers = getBrothersRecordset()
  Set rsoBrothersCopy = copyRecordset(rsoMembers)
    
  numberOfMembersEachGroup = ctrNumberOfMembersEachGroup
  numberOfGroups = getNumberOfGroups(rsoBrothersCopy.recordCount, numberOfMembersEachGroup)
  ReDim groups(numberOfGroups)
   
  For groupIndex = 1 To numberOfGroups
    For memberIndex = 1 To numberOfMembersEachGroup
      brotherIndex = 1
      randomBrotherIndex = getRandomBrotherIndex(rsoBrothersCopy.recordCount)
       
      If (rsoBrothersCopy.recordCount = 0) Then Exit For
       
      rsoBrothersCopy.MoveFirst
      Do Until rsoBrothersCopy.EOF = True
        If brotherIndex = randomBrotherIndex Then
          group = buildGroup(group, rsoBrothersCopy.Fields!FirstNameField, memberIndex, numberOfMembersEachGroup, rsoBrothersCopy.recordCount)
          rsoBrothersCopy.Delete
        End If
        rsoBrothersCopy.MoveNext
        brotherIndex = brotherIndex + 1
      Loop
       
    Next memberIndex

    groups(groupIndex) = group
    group = ""
  
  Next groupIndex
   
  Call printGroups(groups)
   
  Set rsoBrothersCopy = Nothing
  Set rsoMembers = Nothing

End Sub

Public Function getRandomBrotherIndex(recordCount As Integer) As Integer
  Randomize
  getRandomBrotherIndex = Int(recordCount * Rnd) + 1
End Function

Public Function getNumberOfGroups(totalMembersCount As Integer, numberOfMembersEachGroup As Integer) As Integer
  Dim numberOfGroups As Double
  
  numberOfGroups = totalMembersCount / numberOfMembersEachGroup
  If Int(numberOfGroups) <> numberOfGroups Then
    getNumberOfGroups = Int(numberOfGroups) + 1
  Else
    getNumberOfGroups = Int(numberOfGroups)
  End If
End Function

Public Function copyRecordset(recordsetMembers As ADODB.recordset) As ADODB.recordset
   Dim strm As ADODB.Stream
   Set strm = New ADODB.Stream
   recordsetMembers.Save strm
   
   Set copyRecordset = New ADODB.recordset
   copyRecordset.Open strm
End Function

Public Function buildGroup(strGroup As String, name As String, memberIndex As Integer, numberOfMembersEachGroup As Integer, rsoBrothersCopyCount As Integer) As String
  strGroup = strGroup & name
  
  If isLastMemberORLastBrother(memberIndex, numberOfMembersEachGroup, rsoBrothersCopyCount) Then
    strGroup = strGroup & "."
  Else
    strGroup = strGroup & ", "
  End If
  buildGroup = strGroup
End Function

Public Function isLastMemberORLastBrother(memberIndex As Integer, numberOfMembersEachGroup As Integer, rsoBrothersCopyCount As Integer) As Boolean
  isLastMemberORLastBrother = (memberIndex = numberOfMembersEachGroup) Or (rsoBrothersCopyCount = 1)
End Function

Public Sub printGroups(ByRef groups() As String)
  Dim groupIndex As Integer
  Dim allGroups As String
  groupIndex = 1
  
  Do While groupIndex <= UBound(groups)
    allGroups = allGroups & "Grupo " & groupIndex & ":  " & groups(groupIndex) & vbCrLf
    groupIndex = groupIndex + 1
  Loop
  
  txtGroups.SetFocus
  txtGroups.Text = allGroups
End Sub

Public Function getBrothersRecordset() As ADODB.recordset
  Dim cntCurrentDB As ADODB.Connection
  Set cntCurrentDB = CurrentProject.Connection
  Set getBrothersRecordset = New ADODB.recordset
  
  getBrothersRecordset.Open "SELECT * FROM lstMembers", cntCurrentDB, adOpenKeyset, adLockOptimistic
  'cntCurrentDB.Close Connection can not be closed here
End Function
